{"ast":null,"code":"var _jsxFileName = \"/Users/daniellluis 1/Desktop/noticias_colaborativas/proyecto_final/frontend/src/pages/NewsSinglePage.js\",\n    _s = $RefreshSig$();\n\nimport { useContext, useEffect, useState } from \"react\";\nimport { Redirect, useParams } from \"react-router-dom\";\nimport { Token } from \"../components/token\";\nimport { deleteComment, deleteNews, postComment } from \"../api/api\";\nimport { postReactionComment, getSingleNewsComments } from \"../api/api\";\nimport { ErrorContext } from \"../components/error\";\nimport Comment from \"../components/Comment\";\nimport News from \"../components/News\";\nimport { useHistory } from \"react-router-dom\";\nimport jwt_decode from \"jwt-decode\";\nimport { useRemoteSingleNews } from \"../hooks/remoteHooks\";\nimport PartnerList from \"../components/PartnerList\";\nimport UsersTop from \"../components/UsersTop\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport function NewsSinglePage() {\n  _s();\n\n  let history = useHistory();\n  const [news, setNews] = useRemoteSingleNews({});\n  const {\n    id\n  } = useParams();\n  const [, setError] = useContext(ErrorContext);\n  const [token] = useContext(Token);\n  let userId;\n\n  if (token) {\n    userId = jwt_decode(token).id;\n  } // const { rol } = decodedToken;\n  // useEffect(() => {\n  //   async function getNews() {\n  //     try {\n  //       const response = await fetch(\n  //         `http://localhost:3000/api/v1/news/${id}`,\n  //         {\n  //           method: \"GET\",\n  //           headers: {\n  //             \"Content-type\": \"application/json\",\n  //           },\n  //         }\n  //       );\n  //       const json = await response.json();\n  //       if (response.ok) {\n  //         setNews(json);\n  //       } else {\n  //         throw new Error(json.error);\n  //       }\n  //     } catch (error) {\n  //       setError(error.message);\n  //     }\n  //   }\n  //   getNews();\n  // }, [id, setError]);\n  // Cargar comentarios\n\n\n  const [comments, setComments] = useState([]);\n  useEffect(() => {\n    const getComments = async () => {\n      try {\n        const response = await getSingleNewsComments(id);\n        const body = await response.json();\n\n        if (response.ok) {\n          setComments(body);\n        } else {\n          throw new Error(body.error);\n        }\n      } catch (error) {\n        setError(error.message);\n      }\n    };\n\n    getComments();\n  }, [id, setError]); // Crear comentario\n\n  const [createComment, setCreateComment] = useState([]);\n\n  const postCommentHandler = async e => {\n    e.preventDefault();\n    const requestBody = {\n      comment: createComment\n    };\n\n    try {\n      const response = await postComment(requestBody, id, token);\n      const body = await response.json();\n\n      if (response.ok) {\n        const getComments = async () => {\n          try {\n            const response = await getSingleNewsComments(id);\n            const body = await response.json();\n\n            if (response.ok) {\n              setComments(body);\n            } else {\n              throw new Error(body.error);\n            }\n          } catch (error) {\n            setError(error.message);\n          }\n        };\n\n        getComments();\n      } else {\n        throw new Error(body.error);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  }; // Eliminar noticia\n\n\n  async function deleteNewsHandler(e) {\n    try {\n      const idNews = e.target.value;\n      const res = await deleteNews(idNews, token);\n      const bodyDeLaRespuesta = await res.json();\n\n      if (res.ok) {\n        setNews();\n        history.push(\"/\");\n      } else {\n        throw new Error(bodyDeLaRespuesta.error);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  } // Eliminar comentario\n\n\n  async function deleteCommentHandler(e) {\n    try {\n      const idComment = e.target.value;\n      const res = await deleteComment(idComment, token);\n      const bodyDeLaRespuesta = await res.json();\n\n      if (res.ok) {\n        setComments(comments.filter(comment => comment.id !== Number(idComment)));\n      } else {\n        throw new Error(bodyDeLaRespuesta.error);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  } //Reaccionar a Comentario\n\n\n  async function reactComment(id, reaction) {\n    const vote = {\n      like: reaction,\n      dislike: !reaction\n    };\n\n    try {\n      const res = await postReactionComment(vote, id, token);\n      const data = await res.json();\n\n      if (res.ok) {\n        setComments(comments.map(comment => {\n          if (comment.id === id) {\n            return data;\n          }\n\n          return comment;\n        }));\n      } else {\n        throw new Error(data.error);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"grid-container\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid-main\",\n          children: [Object.keys(news).length > 0 && /*#__PURE__*/_jsxDEV(News, {\n            noticias: news\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 46\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: news.id_user === userId ? /*#__PURE__*/_jsxDEV(\"button\", {\n              style: {\n                display: \"block\"\n              },\n              value: news.id,\n              onClick: deleteNewsHandler,\n              children: \"Borrar noticia\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 185,\n              columnNumber: 17\n            }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n              style: {\n                display: \"none\"\n              },\n              value: news.id,\n              onClick: deleteNewsHandler,\n              children: \"Borrar noticia\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 193,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n            children: comments.map(comment => /*#__PURE__*/_jsxDEV(\"li\", {\n              children: [/*#__PURE__*/_jsxDEV(Comment, {\n                comment: comment,\n                reactComment: reactComment\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 225,\n                columnNumber: 19\n              }, this), comment.id_user === userId ? /*#__PURE__*/_jsxDEV(\"button\", {\n                style: {\n                  display: \"block\"\n                },\n                value: comment.id,\n                onClick: deleteCommentHandler,\n                children: \"Eliminar\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 230,\n                columnNumber: 21\n              }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                style: {\n                  display: \"none\"\n                },\n                value: comment.id,\n                onClick: deleteCommentHandler,\n                children: \"Eliminar\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 238,\n                columnNumber: 21\n              }, this)]\n            }, comment.id, true, {\n              fileName: _jsxFileName,\n              lineNumber: 224,\n              columnNumber: 17\n            }, this))\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 222,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"form\", {\n              onSubmit: postCommentHandler,\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n                  children: \"Comentario\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 252,\n                  columnNumber: 19\n                }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n                  name: \"comment\",\n                  type: \"text\",\n                  rows: \"8\",\n                  value: createComment,\n                  onChange: e => setCreateComment(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 253,\n                  columnNumber: 19\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 251,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                type: \"submit\",\n                value: \"Publicar Comentario\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 261,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 250,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 249,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"grid-aside\",\n          children: [/*#__PURE__*/_jsxDEV(UsersTop, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 266,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(PartnerList, {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 265,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 180,\n        columnNumber: 9\n      }, this)\n    }, void 0, false)\n  }, void 0, false);\n}\n\n_s(NewsSinglePage, \"KViVT2PB65T1KjGsWr6QmpUE2c0=\", false, function () {\n  return [useHistory, useRemoteSingleNews, useParams];\n});\n\n_c = NewsSinglePage;\n\nvar _c;\n\n$RefreshReg$(_c, \"NewsSinglePage\");","map":{"version":3,"sources":["/Users/daniellluis 1/Desktop/noticias_colaborativas/proyecto_final/frontend/src/pages/NewsSinglePage.js"],"names":["useContext","useEffect","useState","Redirect","useParams","Token","deleteComment","deleteNews","postComment","postReactionComment","getSingleNewsComments","ErrorContext","Comment","News","useHistory","jwt_decode","useRemoteSingleNews","PartnerList","UsersTop","NewsSinglePage","history","news","setNews","id","setError","token","userId","comments","setComments","getComments","response","body","json","ok","Error","error","message","createComment","setCreateComment","postCommentHandler","e","preventDefault","requestBody","comment","deleteNewsHandler","idNews","target","value","res","bodyDeLaRespuesta","push","deleteCommentHandler","idComment","filter","Number","reactComment","reaction","vote","like","dislike","data","map","Object","keys","length","id_user","display"],"mappings":"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","sourcesContent":["import { useContext, useEffect, useState } from \"react\";\nimport { Redirect, useParams } from \"react-router-dom\";\nimport { Token } from \"../components/token\";\nimport { deleteComment, deleteNews, postComment } from \"../api/api\";\nimport { postReactionComment, getSingleNewsComments } from \"../api/api\";\nimport { ErrorContext } from \"../components/error\";\nimport Comment from \"../components/Comment\";\nimport News from \"../components/News\";\nimport { useHistory } from \"react-router-dom\";\nimport jwt_decode from \"jwt-decode\";\nimport { useRemoteSingleNews } from \"../hooks/remoteHooks\";\nimport PartnerList from \"../components/PartnerList\";\nimport UsersTop from \"../components/UsersTop\";\n\nexport function NewsSinglePage() {\n  let history = useHistory();\n  const [news, setNews] = useRemoteSingleNews({});\n  const { id } = useParams();\n  const [, setError] = useContext(ErrorContext);\n  const [token] = useContext(Token);\n\n  let userId;\n  if (token) {\n    userId = jwt_decode(token).id;\n  }\n\n  // const { rol } = decodedToken;\n\n  // useEffect(() => {\n  //   async function getNews() {\n  //     try {\n  //       const response = await fetch(\n  //         `http://localhost:3000/api/v1/news/${id}`,\n  //         {\n  //           method: \"GET\",\n  //           headers: {\n  //             \"Content-type\": \"application/json\",\n  //           },\n  //         }\n  //       );\n  //       const json = await response.json();\n  //       if (response.ok) {\n  //         setNews(json);\n  //       } else {\n  //         throw new Error(json.error);\n  //       }\n  //     } catch (error) {\n  //       setError(error.message);\n  //     }\n  //   }\n  //   getNews();\n  // }, [id, setError]);\n\n  // Cargar comentarios\n\n  const [comments, setComments] = useState([]);\n  useEffect(() => {\n    const getComments = async () => {\n      try {\n        const response = await getSingleNewsComments(id);\n        const body = await response.json();\n        if (response.ok) {\n          setComments(body);\n        } else {\n          throw new Error(body.error);\n        }\n      } catch (error) {\n        setError(error.message);\n      }\n    };\n    getComments();\n  }, [id, setError]);\n\n  // Crear comentario\n\n  const [createComment, setCreateComment] = useState([]);\n\n  const postCommentHandler = async (e) => {\n    e.preventDefault();\n    const requestBody = {\n      comment: createComment,\n    };\n\n    try {\n      const response = await postComment(requestBody, id, token);\n      const body = await response.json();\n      if (response.ok) {\n        const getComments = async () => {\n          try {\n            const response = await getSingleNewsComments(id);\n            const body = await response.json();\n            if (response.ok) {\n              setComments(body);\n            } else {\n              throw new Error(body.error);\n            }\n          } catch (error) {\n            setError(error.message);\n          }\n        };\n        getComments();\n      } else {\n        throw new Error(body.error);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  };\n\n  // Eliminar noticia\n\n  async function deleteNewsHandler(e) {\n    try {\n      const idNews = e.target.value;\n      const res = await deleteNews(idNews, token);\n      const bodyDeLaRespuesta = await res.json();\n      if (res.ok) {\n        setNews();\n        history.push(\"/\");\n      } else {\n        throw new Error(bodyDeLaRespuesta.error);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  }\n\n  // Eliminar comentario\n\n  async function deleteCommentHandler(e) {\n    try {\n      const idComment = e.target.value;\n      const res = await deleteComment(idComment, token);\n      const bodyDeLaRespuesta = await res.json();\n      if (res.ok) {\n        setComments(\n          comments.filter((comment) => comment.id !== Number(idComment))\n        );\n      } else {\n        throw new Error(bodyDeLaRespuesta.error);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  }\n\n  //Reaccionar a Comentario\n\n  async function reactComment(id, reaction) {\n    const vote = {\n      like: reaction,\n      dislike: !reaction,\n    };\n    try {\n      const res = await postReactionComment(vote, id, token);\n      const data = await res.json();\n      if (res.ok) {\n        setComments(\n          comments.map((comment) => {\n            if (comment.id === id) {\n              return data;\n            }\n            return comment;\n          })\n        );\n      } else {\n        throw new Error(data.error);\n      }\n    } catch (error) {\n      setError(error.message);\n    }\n  }\n\n  return (\n    <>\n      {/* {!news ? (\n        <Redirect to=\"/\" />\n      ) : ( */}\n      <>\n        <div className=\"grid-container\">\n          <div className=\"grid-main\">\n            {Object.keys(news).length > 0 && <News noticias={news}></News>}\n            <div>\n              {news.id_user === userId ? (\n                <button\n                  style={{ display: \"block\" }}\n                  value={news.id}\n                  onClick={deleteNewsHandler}\n                >\n                  Borrar noticia\n                </button>\n              ) : (\n                <button\n                  style={{ display: \"none\" }}\n                  value={news.id}\n                  onClick={deleteNewsHandler}\n                >\n                  Borrar noticia\n                </button>\n              )}\n            </div>\n\n            {/* <div>\n            {news.id_user === idToken && rol === \"partner\" ? (\n              <button\n                style={{ display: \"block\" }}\n                value={news.id}\n                onClick={deleteNewsHandler}\n              >\n                Editar Noticia\n              </button>\n            ) : (\n              <button\n                style={{ display: \"none\" }}\n                value={news.id}\n                onClick={deleteNewsHandler}\n              >\n                Editar noticia\n              </button>\n            )}\n          </div> */}\n            <ul>\n              {comments.map((comment) => (\n                <li key={comment.id}>\n                  <Comment\n                    comment={comment}\n                    reactComment={reactComment}\n                  ></Comment>\n                  {comment.id_user === userId ? (\n                    <button\n                      style={{ display: \"block\" }}\n                      value={comment.id}\n                      onClick={deleteCommentHandler}\n                    >\n                      Eliminar\n                    </button>\n                  ) : (\n                    <button\n                      style={{ display: \"none\" }}\n                      value={comment.id}\n                      onClick={deleteCommentHandler}\n                    >\n                      Eliminar\n                    </button>\n                  )}\n                </li>\n              ))}\n            </ul>\n            <div>\n              <form onSubmit={postCommentHandler}>\n                <div>\n                  <h4>Comentario</h4>\n                  <textarea\n                    name=\"comment\"\n                    type=\"text\"\n                    rows=\"8\"\n                    value={createComment}\n                    onChange={(e) => setCreateComment(e.target.value)}\n                  />\n                </div>\n                <input type=\"submit\" value=\"Publicar Comentario\"></input>\n              </form>\n            </div>\n          </div>\n          <div className=\"grid-aside\">\n            <UsersTop />\n            <PartnerList />\n          </div>\n        </div>\n      </>\n      {/* )} */}\n    </>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}